# Node.js Express MongoDB JWT Project

Цей проект є RESTful API на базі Node.js, Express та MongoDB із використанням JWT для аутентифікації користувачів.

## Зміст
- [Огляд проекту](#overview)
- [Функціональність](#features)
- [Структура проекту](#project-structure)
- [Встановлення та запуск](#installation-and-running)
- [API Ендпоінти](#api-endpoints)
- [JWT (JSON Web Token)](#jwt-json-web-token)
- [Сесії користувача](#user-sessions)
- [Альтернативи аутентифікації](#alternatives)

## Overview

Проект реалізує наступні можливості:
- **Реєстрація користувачів**: Створення нового акаунту з хешуванням пароля.
- **Логін користувачів**: Аутентифікація користувача з генерацією JWT-токену.
- **Захищені маршрути для постів**: Тільки авторизовані користувачі можуть створювати, читати, оновлювати та видаляти пости.

## Features

- **Технології:**
    - **Node.js** – середовище виконання JavaScript.
    - **Express** – мінімалістичний фреймворк для створення веб-додатків.
    - **MongoDB** – NoSQL база даних.
    - **Mongoose** – ODM для MongoDB.
    - **JWT (JSON Web Token)** – для статлес аутентифікації.
    - **Nodemon** – для автоматичного перезапуску сервера під час розробки.
    - **bcrypt** – для безпечного хешування паролів.

- **Функціонал:**
    - Реєстрація та логін користувача.
    - Генерація JWT-токену після успішної авторизації.
    - Захищені CRUD операції для постів, доступні лише для авторизованих користувачів.

## Project Structure

```
project/
├── config/
│   └── config.js         # Конфігурація (порт, MongoDB URI, секрет для JWT)
├── controllers/
│   ├── authController.js # Логіка реєстрації та логіну
│   └── postsController.js# Логіка для CRUD операцій з постами
├── middlewares/
│   └── authMiddleware.js # Middleware для перевірки JWT токену
├── models/
│   ├── User.js           # Модель користувача
│   └── Post.js           # Модель посту
├── routes/
│   ├── authRoutes.js     # Маршрути аутентифікації
│   └── postsRoutes.js    # Захищені маршрути для постів
├── server.js             # Основний файл ініціалізації сервера
└── package.json          # Залежності та скрипти для запуску
```

## Installation and Running

### Передумови:
- **Node.js** встановлено на вашій машині.
- **MongoDB** запущено локально.  
  (Якщо ви використовуєте MongoDB локально, переконайтеся, що сервер запущено, наприклад, командою:
  ```bash
  npm run mongo
  ```  
_Примітка:_ Переконайтеся, що папка `./data/db` існує або змініть шлях у конфігурації.)

### Кроки:
1. **Клонувати репозиторій:**
   ```bash
   git clone <repository_url>
   cd project
   ```
2. **Встановити залежності:**
   ```bash
   npm install
   ```
3. **Запустити сервер:**
    - Для розробки (автоматичний перезапуск):
      ```bash
      npm run dev
      ```
    - Для звичайного запуску:
      ```bash
      npm start
      ```

## API Endpoints

### Аутентифікація
- **POST** `/api/auth/register`  
  Реєстрація нового користувача.  
  _Body (JSON):_
  ```json
  {
    "username": "testuser",
    "email": "test@example.com",
    "password": "yourpassword"
  }
  ```
- **POST** `/api/auth/login`  
  Логін користувача. При успішній аутентифікації повертається JWT токен.  
  _Body (JSON):_
  ```json
  {
    "email": "test@example.com",
    "password": "yourpassword"
  }
  ```

### Пости (захищені маршрути – потребують JWT токен)
> **Примітка:** Для всіх цих маршрутів необхідно встановити заголовок:
> ```
> Authorization: Bearer <your_jwt_token>
> ```

- **GET** `/api/posts`  
  Отримання всіх постів поточного користувача.
- **GET** `/api/posts/:id`  
  Отримання конкретного посту за ID.
- **POST** `/api/posts`  
  Створення нового посту.  
  _Body (JSON):_
  ```json
  {
    "title": "Мій перший пост",
    "content": "Це зміст мого першого посту."
  }
  ```
- **PUT** `/api/posts/:id`  
  Оновлення посту за ID.  
  _Body (JSON):_
  ```json
  {
    "title": "Оновлений заголовок",
    "content": "Оновлений зміст"
  }
  ```
- **DELETE** `/api/posts/:id`  
  Видалення посту за ID.

## JWT (JSON Web Token)

### Що таке JWT?
JWT (JSON Web Token) — це відкритий стандарт (RFC 7519) для безпечного передачі інформації між сторонами у форматі JSON. Токен є компактним, URL-безпечним та самодостатнім.

### Як це працює?
- **Після аутентифікації:**  
  Коли користувач успішно реєструється або логіниться, сервер генерує JWT, що містить корисне навантаження (наприклад, ID користувача). Токен підписується секретним ключем.

- **Клієнтська сторона:**  
  Токен повертається клієнту, який зберігає його (наприклад, у LocalStorage або як cookie). Для кожного запиту до захищених маршрутів клієнт додає цей токен у заголовок `Authorization` у форматі:
  ```
  Authorization: Bearer <your_jwt_token>
  ```

- **Серверна сторона:**  
  При отриманні запиту сервер перевіряє валідність токену за допомогою секретного ключа. Якщо токен дійсний — запит обробляється, інакше повертається помилка аутентифікації.

### Переваги JWT:
- **Статлес аутентифікація:**  
  Не потрібно зберігати сесії на сервері, що спрощує масштабування.
- **Продуктивність:**  
  Відсутність необхідності у пошуку сесійних даних на сервері.
- **Безпека:**  
  Токен підписується, тому не можна змінити його вміст без знання секретного ключа.
- **Гнучкість:**  
  Використовується для різних типів клієнтів та платформ.

### Альтернативи JWT:
- **Сесійна аутентифікація:**  
  Класичний підхід, коли сервер створює сесію після логіну, зберігаючи дані сесії (наприклад, в пам’яті або в базі даних), а клієнт отримує sessionID через cookie.
- **OAuth / OpenID Connect (OIDC):**  
  Протоколи для делегованої аутентифікації та авторизації, які часто використовуються для входу через сторонні сервіси (Google, Facebook).

## User Sessions

### Що таке сесія користувача?
Сесія користувача — це період, протягом якого користувач взаємодіє з додатком. Вона починається під час логіну та закінчується при виході або після закінчення терміну дії сесії.

### Види сесій:
1. **Серверні сесії:**
    - **Як працюють:**  
      Після логіну сервер створює сесію та зберігає дані (наприклад, ID користувача) на стороні сервера. Клієнт отримує sessionID через cookie, яке надсилається із кожним запитом. Сервер використовує sessionID для отримання відповідних даних сесії.
    - **Приклади:**  
      Використання middleware, як-от `express-session` з можливим зберіганням даних в Redis або іншій базі.
2. **Клієнтські сесії (за допомогою JWT):**
    - **Як працюють:**  
      Після успішної аутентифікації сервер видає JWT, який клієнт зберігає локально (LocalStorage, SessionStorage або cookie). Для кожного запиту клієнт додає цей токен, а сервер перевіряє його без необхідності зберігати додаткові дані сесії.
    - **Переваги:**  
      Статлес підхід, що спрощує масштабування та знижує навантаження на сервер.

## Alternatives

Крім JWT існують й інші підходи до аутентифікації:
- **Сесійна аутентифікація:**  
  Вимагає зберігання даних сесії на сервері, що може бути менш масштабованим.
- **OAuth/OIDC:**  
  Забезпечує делеговану аутентифікацію через сторонніх провайдерів, що може бути корисно для інтеграції з соціальними мережами чи іншими службами.

Вибір методу аутентифікації залежить від вимог проекту. У цьому проекті JWT обрано через його простоту, масштабованість та відсутність необхідності керувати серверними сесіями.

## Висновок

Цей проект демонструє, як створити RESTful API з Node.js, Express та MongoDB, використовуючи JWT для захисту маршрутів. Проект містить приклади як для публічних (аутентифікація), так і для захищених (CRUD операції для постів) ендпоінтів. Крім того, у цьому документі наведено огляд JWT, принципи роботи сесій та альтернативні методи аутентифікації.